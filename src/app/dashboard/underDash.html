<!-- Navigation Bar -->
<div class="navbar-fullwidth">
  <nav>
    <div class="navbar nav-container">
      <a routerLink="/" style="text-decoration: none;" class="logo">
        <h3>Star Protect</h3>
      </a>
      <ul class="nav-links">
        <li><a routerLink="/" routerLinkActive="active">New Policy</a></li>
        <!-- <li><a href="#" (click)="showRenewModal = true; $event.preventDefault();">Renew Policy</a></li> -->
      </ul>
      <div class="user-avatar">
        <img src="assets/images/verified.gif" alt="User Avatar" />
        <span class="user-name">Underwriter</span>
      </div>
    </div>
  </nav>
</div>

<!-- Dashboard Content -->
<div class="dashboard-container">
  <h2 class="dashboard-heading">Underwriter Dashboard</h2>

  <div class="form-group">
    <label for="underwriterSelect">Select Underwriter:</label>
    <select id="underwriterSelect" [(ngModel)]="selectedUnderwriterId" (change)="onUnderwriterChange()" [disabled]="loadingUnderwriters">
      <option value="">-- Choose Underwriter --</option>
      <option *ngFor="let u of underwriters" [value]="u.underwriterId">{{u.name}} ({{u.underwriterId}})</option>
    </select>
    <div *ngIf="loadingUnderwriters" style="margin-top: 0.5rem; color: #004b8d; font-size: 0.9rem;">
      Loading underwriters...
    </div>
  </div>

  <div *ngIf="loadingPolicies" class="loading-state">
    <div>Loading policies...</div>
  </div>
  
  <div *ngIf="!loadingPolicies && selectedUnderwriterId && policies.length === 0" class="empty-state">
    <div>No policies found for this underwriter.</div>
  </div>

  <table *ngIf="policies.length > 0" class="policy-table">
    <thead>
      <tr>
        <th>Policy No</th>
        <th>Vehicle No</th>
        <th>Vehicle Type</th>
        <th>Customer Name</th>
        <th>Phone</th>
        <th>Type</th>
        <th>Premium</th>
        <th>From</th>
        <th>To</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let p of policies">
        <td><strong>{{p.policyNo}}</strong></td>
        <td>{{p.vehicleNo}}</td>
        <td>{{p.vehicleType}}</td>
        <td>{{p.customerName}}</td>
        <td>{{p.phoneNo}}</td>
        <td>
          <span class="policy-type" [ngClass]="p.type.toLowerCase().includes('full') ? 'full' : 'third-party'">
            {{p.type}}
          </span>
        </td>
        <td class="premium-amount">â‚¹{{p.premiumAmt}}</td>
        <td class="date-cell">{{p.fromDate | date:'dd/MM/yyyy'}}</td>
        <td class="date-cell">{{p.toDate | date:'dd/MM/yyyy'}}</td>
      </tr>
    </tbody>
  </table>

  <!-- Renew Policy Modal -->
  <div class="modal-overlay" *ngIf="showRenewModal">
    <div class="modal-box">
      <h3>Renew Policy</h3>
      <form (ngSubmit)="submitRenewal()" #renewForm="ngForm">
        <div class="form-group">
          <label for="policyNo">Policy Number</label>
          <input id="policyNo" name="policyNo" [(ngModel)]="renewFormData.policyNo" required />
        </div>
        <div class="form-group">
          <label for="renewDate">Renewal Date</label>
          <input id="renewDate" name="renewDate" type="date" [(ngModel)]="renewFormData.renewDate" required />
        </div>
        <div class="modal-actions">
          <button type="button" class="btn btn-cancel" (click)="showRenewModal = false">Cancel</button>
          <button type="submit" class="btn">Submit</button>
        </div>
      </form>
    </div>
  </div>
</div>